import"./index-i4XY-n0d.js";import{t as m,_ as g}from"./http-BRyn90S9.js";import{c as r,e as l,o,f as d,b as c,n,t as p,g as b}from"./vue.esm-bundler-TYCfHD9-.js";import{_ as k}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as I}from"./vitel-YLUX6-hb.js";import{s as v}from"./entry-preview-DsY0GTd9.js";import"./_commonjsHelpers-_d1bhYXs.js";import"./_commonjs-dynamic-modules-TDtrdbi3.js";import"./isArrayLike-DYVE1Yub.js";import"./isObjectLike-Dipz0mOK.js";import"./isArray-Dxzbedgu.js";import"./_isIterateeCall-B847D5xG.js";import"./_baseSlice-kGIfUibS.js";import"./isSymbol-C1qQj8zB.js";const u={data(){return{data:void 0,displayContent:"",displayClass:void 0,isLazy:!1,loading:!0,useLabel:!0}},props:{url:{type:[Object,String],required:!0},field:{type:String,default:"title"},filter:{type:[Function,String]},cache:{type:String},cacheKey:{type:Function,default(){return["digest",typeof this.url=="string"?this.url:typeof this.url=="object"?this.url.url:this.cache&&(()=>{throw new Error('Cannot determine cache key - must specify an alternate <digest :cache-key="Function"/> binding')})()].join("-")}},label:{type:String},lazy:{type:Boolean,default:!0},lazyParents:{type:String,default:"#content, #main, body"},lazyParentsDisable:{type:String,default:".modal"},classValid:{type:String},classInvalid:{type:String},textValid:{type:[String,Function]},textInvalid:{type:[String,Function]},textLoading:{type:String,default:""},iconValid:{type:String},iconInvalid:{type:String},iconLoading:{type:String,default:"far fa-spinner fa-spin"},ignoreErrors:{type:Boolean,default:!1},hashMethod:{type:String,defualt:"url+field",validator:e=>["url","url+field","request","custom"].includes(e)},hash:{type:String},httpWrapper:{type:String,default:"throttle"}},methods:{refresh(){if(this.loading=!0,this.useLabel&&this.label)this.displayContent=this.label,this.displayIcon=this.iconValid,this.loading=!1;else return Promise.resolve().then(()=>this.$services.require("$auth?","$http")).then(()=>{if(!this.cache)return;let e=this.cacheKey.apply(this,this),t=globalThis.sessionStorage.getItem(e);if(t){let s=new Date;if(t=JSON.parse(t),t.expires<s){globalThis.sessionStorage.removeItem(e);return}return t.data}}).then(e=>e||this.$http[this.httpWrapper]({method:"GET",url:this.url,hashMethod:this.hashMethod}).then(({data:t})=>t).then(t=>{if(!this.cache)return t;let s=this.cacheKey.apply(this,this);return globalThis.sessionStorage.setItem(s,JSON.stringify({expires:new Date(Date.now()+m(this.cache,"ms")),data:t})),t})).then(e=>{if(this.field=="*"&&e)return e;if(this.field&&this.field!="*"&&e[this.field]!==void 0)return e[this.field];if(this.field&&this.field!="*")console.trace(`Data from URL ${this.url} does not contain field "${this.field}"`,e);else return e}).then(e=>{if(this.data=e,this.displayContent=typeof this.textValid=="string"?this.textValid:typeof this.textValid=="function"?this.textValid(e):e,this.filter)if(typeof this.filter=="function")this.displayContent=this.filter(this.displayContent);else if(typeof this.filter=="string"){var t=this.$filters[this.filter];if(!t)throw new Error(`Unknown filter "${this.filter}" specified in <digest filter/>`);this.displayContent=t(this.displayContent)}else throw new Error("Unknown filter type specified in <digest filter/>");this.displayIcon=this.iconValid,this.classValid&&(this.displayClass=this.classValid)}).catch(e=>{this.displayContent=typeof this.textInvalid=="string"?this.textInvalid:typeof this.textInvalid=="function"?this.textInvalid(e):e.statusText?e.statusText:e,this.displayIcon=this.iconInvalid,this.classInvalid&&(this.displayClass=this.classInvalid),this.ignoreErrors||this.$toast.catch(e)}).finally(()=>this.loading=!1)}},mounted(){if(this.$el.closest(this.lazyParentsDisable)&&(this.isLazy=!1),this.isLazy){var e=new IntersectionObserver(()=>{this.refresh(),e.disconnect(),e=null},{root:this.$el.closest(this.lazyParents),rootMargin:"100px",threshold:.1});e.observe(this.$el)}else this.refresh()},watch:{url(){this.refresh()}}},S={class:"digest"};function x(e,t,s,V,i,w){return o(),r("div",S,[i.loading?l(e.$slots,"loading",{key:0,config:e.$props},()=>[d("i",{class:n(s.iconLoading)},null,2),c(" "+p(s.textLoading),1)]):l(e.$slots,"display",{key:1,config:e.$props,data:i.data,displayContent:i.displayContent},()=>[d("div",{class:n(i.displayClass)},[e.displayIcon?(o(),r("i",{key:0,class:n(e.displayIcon)},null,2)):b("",!0),c(" "+p(i.displayContent),1)],2)])])}const C=k(u,[["render",x]]);u.__docgenInfo={exportName:"default",displayName:"digest",type:1,props:[{name:"lazy",global:!1,description:"",tags:[],required:!1,type:"boolean",declarations:[],schema:{kind:"enum",type:"boolean",schema:["false","true"]},default:"true"},{name:"field",global:!1,description:"",tags:[],required:!1,type:"string",declarations:[],schema:"string",default:'"title"'},{name:"cacheKey",global:!1,description:"",tags:[],required:!1,type:"Function",declarations:[],schema:{kind:"object",type:"Function"}},{name:"lazyParents",global:!1,description:"",tags:[],required:!1,type:"string",declarations:[],schema:"string",default:'"#content, #main, body"'},{name:"lazyParentsDisable",global:!1,description:"",tags:[],required:!1,type:"string",declarations:[],schema:"string",default:'".modal"'},{name:"textLoading",global:!1,description:"",tags:[],required:!1,type:"string",declarations:[],schema:"string",default:'""'},{name:"iconLoading",global:!1,description:"",tags:[],required:!1,type:"string",declarations:[],schema:"string",default:'"far fa-spinner fa-spin"'},{name:"ignoreErrors",global:!1,description:"",tags:[],required:!1,type:"boolean",declarations:[],schema:{kind:"enum",type:"boolean",schema:["false","true"]},default:"false"},{name:"httpWrapper",global:!1,description:"",tags:[],required:!1,type:"string",declarations:[],schema:"string",default:'"throttle"'},{name:"key",global:!0,description:"",tags:[],required:!1,type:"PropertyKey",declarations:[],schema:{kind:"enum",type:"PropertyKey",schema:["string","number","symbol"]}},{name:"ref",global:!0,description:"",tags:[],required:!1,type:"VNodeRef",declarations:[],schema:{kind:"enum",type:"VNodeRef",schema:["string","Ref<any, any>",{kind:"event",type:"(ref: Element | ComponentPublicInstance<{}, {}, {}, {}, {}, {}, {}, {}, false, ComponentOptionsBase<any, any, any, any, any, any, any, any, any, {}, {}, string, {}, {}, {}, string, ComponentProvideOptions>, ... 4 more ..., any>, refs: Record<...>): void"}]}},{name:"ref_for",global:!0,description:"",tags:[],required:!1,type:"boolean",declarations:[],schema:{kind:"enum",type:"boolean",schema:["false","true"]}},{name:"ref_key",global:!0,description:"",tags:[],required:!1,type:"string",declarations:[],schema:"string"},{name:"class",global:!0,description:"",tags:[],required:!1,type:"unknown",declarations:[],schema:"unknown"},{name:"style",global:!0,description:"",tags:[],required:!1,type:"unknown",declarations:[],schema:"unknown"}],events:[],slots:[],exposed:[{name:"lazy",type:"boolean",description:"",declarations:[],schema:{kind:"enum",type:"boolean",schema:["false","true"]}},{name:"field",type:"string",description:"",declarations:[],schema:"string"},{name:"cacheKey",type:"Function",description:"",declarations:[],schema:{kind:"object",type:"Function"}},{name:"lazyParents",type:"string",description:"",declarations:[],schema:"string"},{name:"lazyParentsDisable",type:"string",description:"",declarations:[],schema:"string"},{name:"textLoading",type:"string",description:"",declarations:[],schema:"string"},{name:"iconLoading",type:"string",description:"",declarations:[],schema:"string"},{name:"ignoreErrors",type:"boolean",description:"",declarations:[],schema:{kind:"enum",type:"boolean",schema:["false","true"]}},{name:"httpWrapper",type:"string",description:"",declarations:[],schema:"string"},{name:"data",type:"any",description:"",declarations:[],schema:"any"},{name:"displayContent",type:"string",description:"",declarations:[],schema:"string"},{name:"displayClass",type:"any",description:"",declarations:[],schema:"any"},{name:"isLazy",type:"boolean",description:"",declarations:[],schema:{kind:"enum",type:"boolean",schema:["false","true"]}},{name:"loading",type:"boolean",description:"",declarations:[],schema:{kind:"enum",type:"boolean",schema:["false","true"]}},{name:"useLabel",type:"boolean",description:"",declarations:[],schema:{kind:"enum",type:"boolean",schema:["false","true"]}}],sourceFiles:"/home/runner/work/Vitel/Vitel/components/digest.vue"};v(e=>{e.use(I),e.service("$http",g)});const O={title:"Components/Digest",component:C,tags:["autodocs"]},a={args:{url:"/api/users/count",field:"count",classValid:"badge rounded-pill bg-primary",iconValid:"fas fa-user",classInvalid:"badge rounded-pill bg-danger",iconInvalid:"fas fa-circle-xmark",textInvalid:"Error fetching users"}};var h,f,y;a.parameters={...a.parameters,docs:{...(h=a.parameters)==null?void 0:h.docs,source:{originalSource:`{
  args: {
    url: '/api/users/count',
    field: 'count',
    // Styling:
    classValid: 'badge rounded-pill bg-primary',
    iconValid: 'fas fa-user',
    classInvalid: 'badge rounded-pill bg-danger',
    iconInvalid: 'fas fa-circle-xmark',
    textInvalid: 'Error fetching users'
  }
}`,...(y=(f=a.parameters)==null?void 0:f.docs)==null?void 0:y.source}}};const R=["Example"];export{a as Example,R as __namedExportsOrder,O as default};
